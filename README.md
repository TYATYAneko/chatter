# StudyBoard

グループ学習ノート共有アプリケーション

## バージョン

**v2.8.0**

## 概要

StudyBoardは、グループでノートを共有できるWebアプリケーションです。個人情報不要で手軽に利用できます。

**v2.1.0からFirebase Authentication対応！** APIキーが見られても安全です。

## 機能

### 認証
- **アカウント作成**: ニックネームとパスワードのみ（メールアドレス不要）
- **ログイン/ログアウト**
- **クロスデバイス対応**: Firebaseを設定すれば、どの端末からでもログイン可能
- **セキュア認証**: Firebase Authenticationによる安全な認証

### グループ
- **グループ作成**: 任意の名前でグループを作成
- **招待コード**: 6桁の英数字（自動生成または自分で設定可能）
- **グループ参加**: コードを入力して参加
- **グループ退出**: メニューから退出可能
- **グループ情報**: メンバー一覧などを確認

### ノート共有
- **メモ投稿**: テキストメモの投稿・共有
- **画像送信**: 画像ファイルの送信・共有（5MBまで、Base64形式）
- **URL自動リンク**: メッセージ内のURLを自動的にクリック可能なリンクに変換
- **リアルタイム更新**: Firebaseでリアルタイム同期
- **システム通知**: 参加・退出の通知
- **メッセージ遅延読み込み**: 最新20件のみ表示、古いメッセージは必要時に読み込み

### 設定
- **テーマ**: ライト / ダーク / ブルー / グリーン
- **フォントサイズ**: 小 / 中 / 大
- 設定は自動保存され、次回も反映

## 使い方

1. 下記のFirebaseセットアップを完了
2. `index.html` をブラウザで開く
3. アカウントを作成またはログイン
4. グループを作成、またはコードを入力して参加
5. ノート共有開始

※ Firebase必須です（v2.4.0以降）

## Firebaseセットアップ

### 1. Firebaseプロジェクトを作成
1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. 「プロジェクトを追加」をクリック
3. プロジェクト名を入力して作成

### 2. Authentication を有効化
1. 左メニュー「構築」→「Authentication」
2. 「始める」をクリック
3. 「メール / パスワード」を選択して「有効にする」
4. 「保存」

### 3. Realtime Databaseを有効化
1. 左メニューから「Realtime Database」を選択
2. 「データベースを作成」をクリック
3. ロケーションを選択（asia-southeast1 推奨）
4. 「テストモードで開始」を選択

### 4. ウェブアプリを追加
1. プロジェクト設定（歯車アイコン）→「マイアプリ」
2. 「</>」（ウェブ）をクリック
3. アプリ名を入力して登録
4. 表示される設定情報をコピー

### 5. 設定をindex.htmlに入力
`index.html` の `firebaseConfig` セクションを編集して設定情報を入力してください。

### 6. セキュリティルールの設定（重要）
Realtime Database → ルール で以下を設定:

```json
{
  "rules": {
    "users": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "groups": {
      ".read": "auth != null",
      "$groupCode": {
        ".write": "auth != null"
      }
    },
    "userGroups": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "userReadCounts": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    },
    "userLastReadKeys": {
      "$uid": {
        ".read": "auth != null && auth.uid === $uid",
        ".write": "auth != null && auth.uid === $uid"
      }
    }
  }
}
```

このルールにより：
- ログインしたユーザーのみデータにアクセス可能
- 他人のデータは読み書き不可
- APIキーが漏れても安全

## ファイル構成

```
Chatter/
├── index.html    # メインHTML（Firebase設定を含む）
├── style.css     # スタイルシート
├── app.js        # JavaScript（Firebase Auth/Storage対応）
├── favicon.svg   # アイコン
├── .gitignore    # Git除外設定
└── README.md     # このファイル
```

## 技術仕様

- **フロントエンド**: HTML / CSS / JavaScript
- **認証**: Firebase Authentication
- **データベース**: Firebase Realtime Database
- **画像保存**: Base64エンコード（Realtime Databaseに保存）
- **ローカル保存**: 設定・通知のみlocalStorage
- **既読同期**: 既読状態はFirebaseに保存（端末間で同期）
- **同期**: Firebaseリアルタイムリスナー

## セキュリティ

| 保護レベル | 内容 |
|-----------|------|
| Firebase Auth | ログイン必須でデータアクセス |
| セキュリティルール | 認証済みユーザーのみ読み書き可 |
| UID制限 | 他人のユーザーデータにアクセス不可 |

## 更新履歴

### v2.8.0
- **未読管理システムの改善**
  - 既読キーの管理をFirebase専用に一元化（ローカルキャッシュの重複管理を廃止）
  - メッセージのマージ処理を改善（重複除去とソートを確実に実行）
  - 新着メッセージの表示順序が正しくなるよう修正

### v2.7.0
- **未読管理の端末間同期**
  - 既読状態をFirebaseにリアルタイム同期
  - 同じアカウントなら全端末で未読数が一致
  - 他端末で既読にするとバッジが自動で消える
- **新着メッセージバッジのリアルタイム更新**
  - メッセージ受信時に即座にバッジが表示される
- **新着メッセージへの自動スクロール**
  - グループを開いたとき、未読メッセージの先頭位置にスクロール
  - 20件を超える未読がある場合も自動で古いメッセージを読み込んで移動

### v2.6.0
- **Firebase使用量の最適化**
  - メッセージの初回表示を20件に制限（転送量節約）
  - 「古いメッセージを読み込む」ボタンで必要時のみ追加取得
  - タブが非アクティブの間は接続を解除（接続数節約）
- **既読管理の改善**
  - 既読状態をFirebaseに保存（端末間で同期）
  - 自分が送信したメッセージは未読にカウントされない
- **URL自動リンク**: メッセージ内のURLをクリック可能なリンクに変換

### v2.5.0
- **メッセージ削除機能**: 自分が投稿したメッセージを削除可能に
- メッセージにホバーすると×ボタンが表示

### v2.4.2
- メッセージの最大文字数を500文字に制限
- グループを開いたときに確実に最新のメッセージまでスクロール（画像読み込み後も対応）

### v2.4.1
- 空のグループを自動削除: メンバーが0人になったグループは自動的に削除

### v2.4.0
- **Firebase専用に変更**: ローカルモードを削除
- コードを大幅に簡略化（約200行削減）
- Firebase未設定時はエラーメッセージを表示

### v2.3.7
- ダークモードの表示問題を全面的に修正

### v2.3.6
- ダークモードで設定画面の通知テキストが見えない問題を修正

### v2.3.5
- ダークモードでユーザー名が見えない問題を修正

### v2.3.4
- ロビー画面で縦スクロールできるように修正
- コンテンツが画面に収まらない場合でも全体が見えるように

### v2.3.3
- アクセスコード機能を削除
- エントリー画面を削除し、直接ログイン画面を表示

### v2.3.2
- グループ内メッセージ数を最大100件に制限
- 100件を超えると古いメッセージから自動削除
- データベース容量の節約

### v2.3.1
- 画像保存方式をBase64に変更（Firebase Storageが不要に）
- Firebase Storage SDKを削除
- 無料プランでも画像送信が可能

### v2.3.0
- **画像送信機能追加**: チャットで画像を送信可能に
- 画像クリックで拡大表示
- 5MBまでの画像に対応

### v2.2.2
- 不要なデバッグログを削除
- firebase-config関連ファイルを削除（設定はindex.htmlにインライン化済み）
- READMEのFirebaseセットアップ手順を更新

### v2.2.0
- **通知システム追加**: 新着メッセージをブラウザ通知でお知らせ
- グループごとに通知ON/OFF設定可能
- グループ情報からトグルで切り替え
- 自分のメッセージは通知しない
- 参加・退出メッセージも通知

### v2.2.1
- 設定モーダルから通知のON/OFFを変更可能に

### v2.1.6
- 参加・退出時のシステムメッセージが正しく表示されるよう修正
- Firebase/ローカル両対応の保存処理を改善

### v2.1.5
- 未読メッセージ数をバッジで表示（赤色、最大99+）
- グループを開くと自動で既読に
- リアルタイムで既読状態を更新

### v2.1.4
- チャット画面の完全固定化
- 投稿ボタンのサイズを固定幅（70px）に変更
- メッセージエリアのスクロール改善
- オーバースクロール防止

### v2.1.3
- スマホでの画面スクロール・ドラッグを防止
- ビューポート固定でUIの動きをロック
- ズーム無効化で誤操作防止

### v2.1.2
- PC画面でのノート画面の横幅を制限（最大700px）
- メッセージ入力欄と投稿ボタンの比率を7:3に調整
- 各テーマのチャット画面背景を最適化

### v2.1.1
- GitHub Pages対応: Firebase設定をインライン化
- ロビー画面のレイアウト修正（縦並びに変更）
- Firebase初期化のデバッグログ追加

### v2.1.0
- **Firebase Authentication対応**: セキュアな認証システム
- セキュリティルールで完全保護
- パスワードは6文字以上に変更（Firebase要件）
- ユーザーデータをUID単位で管理

### v2.0.0
- **Firebase対応**: 異なる端末間でデータ共有が可能に
- リアルタイム同期機能を追加
- オンライン/オフライン自動切り替え
- 非同期処理に対応

### v1.1.0
- 表記を学習ツール向けに変更
- 「ルーム」→「グループ」
- 「メッセージ」→「メモ/ノート」
- アプリ名を「StudyBoard」に変更

### v1.0.0
- 初回リリース
- アカウント登録・ログイン機能
- グループ作成・参加・退出機能
- ノート共有機能
- テーマ設定（4種類）
- フォントサイズ設定
